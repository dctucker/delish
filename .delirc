longdesc = {
  arg $stat
  $modes = ""
  if $stat.test -L {
    $modes += "l"
  } elif $stat.test -d {
    $modes += "d"
  } elif $stat.test -f {
    $modes += "-"
  } elif $stat.test -b {
    $modes += "b"
  } elif $stat.test -c {
    $modes += "c"
  } elif $stat.test -k {
    $modes += "k"
  } elif $stat.test -p {
    $modes += "p"
  } elif $stat.test -S {
    $modes += "s"
  } else {
    $modes += "?"
  }
  $curmode = 0400
  $modechar = [ 'r', 'w', 'x' ]
  $seq = Array.seq 1 9
  for $i in $seq {
    if ( $stat.mode and $curmode ) != 0 {
      $j = ( ( $i - 1 ) % 3 )
      $modes += $modechar.$j
    } else {
      $modes += "-"
    }
    $curmode = ( $curmode shr 1 )
  }
  return $modes
}

ll = {
  $list = Path.pwd.list -l

  for $st in $list {
    $modes = longdesc $st
    out $modes, " ", $st.path
  }
}

ls = {
  local $pwd = Path.pwd
  for $f in $pwd.list {
    $modes = longdesc $f.stat
    out $modes, " ", $f
    #.stat.mode.oct, " ", $f
  }
}

ll
