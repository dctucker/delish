ls = {
  local $pwd = Path.pwd
  for $f in $pwd.list {
    $stat = $f.stat
    local $modes = ['-','-','-','-','-','-','-','-','-','-']
    if $stat.test -L {
      $modes.0 = "l"
    } elif $stat.test -d {
      $modes.0 = "d"
    } elif $stat.test -f {
      $modes.0 = "-"
    } elif $stat.test -b {
      $modes.0 = "b"
    } elif $stat.test -c {
      $modes.0 = "c"
    } elif $stat.test -k {
      $modes.0 = "k"
    } elif $stat.test -p {
      $modes.0 = "p"
    } elif $stat.test -S {
      $modes.0 = "s"
    } else {
      $modes.0 = "?"
    }
    $curmode = 0400
    $modechar = [ 'r', 'w', 'x' ]
    $seq = Array.seq 1 9
    for $i in $seq {
      if ( $stat.mode and $curmode ) != 0 {
        $j = ( ( $i - 1 ) % 3 )
        $modes.$i = $modechar.$j
      } else {
        $modes.$i = "-"
      }
      $curmode = ( $curmode shr 1 )
    }
    out $modes.join, " ", $f
    #.stat.mode.oct, " ", $f
  }
}
ls
